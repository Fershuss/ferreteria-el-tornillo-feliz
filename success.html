<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pago exitoso</title>
  <link rel="stylesheet" href="style.css">
  <style>
    body {
      background: #121212;
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100vh;
      flex-direction: column;
      text-align: center;
    }
    h1 { color: #4caf50; }
    a {
      background: #4caf50;
      padding: 10px 20px;
      color: #fff;
      text-decoration: none;
      border-radius: 8px;
      margin-top: 20px;
      display: inline-block;
    }
  </style>
</head>
<body>
  <h1>‚úÖ Pago completado</h1>
  <p>Gracias por tu compra. Pronto recibir√°s la confirmaci√≥n en tu correo.</p>
  <p>Tu orden se descargar√° autom√°ticamente en PDF.</p>
  <a href="index.html">Volver a la tienda</a>

  <!-- Librer√≠as para PDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>

  <script>
    document.addEventListener("DOMContentLoaded", async () => {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();

      // üé® Estilo base
      const colorPrincipal = [76, 175, 80]; // verde √©xito
      const logoUrl = "https://i.imgur.com/MUJl1mD.png"; // cambia este enlace por tu logo

      // üßæ Crear encabezado
      try {
        const logo = await loadImage(logoUrl);
        doc.addImage(logo, "PNG", 15, 10, 30, 30);
      } catch (e) {
        console.warn("No se pudo cargar el logo:", e);
      }

      doc.setFontSize(18);
      doc.setTextColor(...colorPrincipal);
      doc.text("Ferreter√≠a El Tornillo Feliz", 55, 20);

      doc.setFontSize(12);
      doc.setTextColor(80, 80, 80);
      doc.text("Orden de compra", 55, 30);
      doc.text("Tel: +502 5555 5555 | Email: contacto@tornillofeliz.com", 55, 37);

      const fecha = new Date().toLocaleString();
      const numeroOrden = "ORD-" + Date.now().toString().slice(-6);

      doc.text(`Fecha: ${fecha}`, 140, 50);
      doc.text(`N¬∞ Orden: ${numeroOrden}`, 140, 57);

      // üõí Productos
      const carrito = JSON.parse(localStorage.getItem("carrito") || "[]");

      if (carrito.length === 0) {
        doc.text("No se encontraron productos en la orden.", 20, 70);
      } else {
        const tabla = carrito.map(item => [
          item.nombre,
          item.cantidad,
          `Q${item.precio.toFixed(2)}`,
          `Q${(item.cantidad * item.precio).toFixed(2)}`
        ]);

        const total = carrito.reduce((sum, i) => sum + i.precio * i.cantidad, 0);

        doc.autoTable({
          startY: 70,
          head: [["Producto", "Cantidad", "Precio Unitario", "Subtotal"]],
          body: tabla,
          theme: "grid",
          headStyles: { fillColor: colorPrincipal },
          styles: { fontSize: 11, halign: "center" },
          columnStyles: { 0: { halign: "left" } },
        });

        const finalY = doc.lastAutoTable.finalY + 10;
        doc.setFontSize(14);
        doc.setTextColor(...colorPrincipal);
        doc.text(`Total: Q${total.toFixed(2)}`, 150, finalY);
      }

      // üß° Mensaje final
      doc.setFontSize(12);
      doc.setTextColor(100, 100, 100);
      doc.text("¬°Gracias por confiar en nosotros! üõ†Ô∏è", 20, 270);
      doc.text("Ferreter√≠a El Tornillo Feliz ¬© 2025", 20, 278);

      // üíæ Descargar autom√°ticamente
      setTimeout(() => {
        doc.save(`${numeroOrden}_tornillo_feliz.pdf`);
        localStorage.removeItem("carrito");
      }, 1500);

      // üîß Carga del logo en base64
      async function loadImage(url) {
        const res = await fetch(url);
        const blob = await res.blob();
        return await toBase64(blob);
      }

      function toBase64(blob) {
        return new Promise((resolve, reject) => {
          const reader = new FileReader();
          reader.onloadend = () => resolve(reader.result);
          reader.onerror = reject;
          reader.readAsDataURL(blob);
        });
      }
    });
  </script>
</body>
</html>

